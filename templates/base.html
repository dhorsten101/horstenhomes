{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{% block title %}Horsten Homes{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% block meta %}{% endblock %}

    <!-- Bootstrap CSS (CDN – intentional for dev + early product) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
<!--    integrity="sha384-…"-->
<!--    crossorigin="anonymous">-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>

    <link rel="icon" href="{% static 'favicon.png' %}" type="image/png">
    <link rel="apple-touch-icon" href="{% static 'favicon.png' %}">

    <link href="/static/css/theme.css" rel="stylesheet">
    {% block css %}{% endblock %}
</head>

<body class="bg-light">

<!-- Navbar -->
{% include "partials/navbar.html" %}

<!-- Page content -->
<main class="container py-4">
    {% block content %}{% endblock %}
</main>

<!-- Footer -->
{% include "partials/footer.html" %}

{% block js %}{% endblock %}

{% if messages %}
<div id="django-messages" class="d-none">
  {% for message in messages %}
    <div data-level="{{ message.tags }}" data-text="{{ message|escapejs }}"></div>
  {% endfor %}
</div>
{% endif %}

<script src="{% static 'js/ui.js' %}" defer></script>

<script>
(() => {
  const endpoint = "/logs/client/";
  const maxLen = 5000;

  function send(level, message, extra = {}) {
    try {
      const payload = {
        level,
        message: ("" + message).slice(0, maxLen),
        url: location.href,
        ts: Date.now(),
        ...extra,
      };
      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        keepalive: true,
      }).catch(() => {});
    } catch (_) {}
  }

  // Capture unhandled errors
  window.addEventListener("error", (e) => {
    send("ERROR", e.message || "window.error", {
      source: e.filename,
      lineno: e.lineno,
      colno: e.colno,
      stack: e.error && e.error.stack ? e.error.stack : "",
    });
  });

  window.addEventListener("unhandledrejection", (e) => {
    const reason = e.reason;
    send("ERROR", "unhandledrejection", {
      reason: reason ? (reason.message || ("" + reason)) : "",
      stack: reason && reason.stack ? reason.stack : "",
    });
  });

  // Hook console warnings/errors
  const origWarn = console.warn;
  const origErr = console.error;
  console.warn = function (...args) {
    send("WARNING", args.map(String).join(" ").slice(0, maxLen));
    return origWarn.apply(console, args);
  };
  console.error = function (...args) {
    send("ERROR", args.map(String).join(" ").slice(0, maxLen));
    return origErr.apply(console, args);
  };
})();
</script>

</body>
</html>