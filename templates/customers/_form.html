<form method="post"
      hx-post="{{ post_url }}"
      hx-target="#customersTable"
      hx-swap="outerHTML">
  {% csrf_token %}

  <div class="mb-3">
    <label class="form-label">Name</label>
    {{ form.name }}
    {% if form.name.errors %}<div class="text-danger small">{{ form.name.errors }}</div>{% endif %}
  </div>

  <div class="mb-3">
    <label class="form-label">Email</label>
    {{ form.email }}
    {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors }}</div>{% endif %}
  </div>

  <div class="d-flex gap-2 justify-content-end">
    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="submit" class="btn btn-primary">Save</button>
  </div>
</form>

<script>
  // When successful submit returns updated table, close modal.
  document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.successful && evt.detail.requestConfig.verb === 'post') {
      const modalEl = document.getElementById('mainModal');
      if (modalEl) {
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) modal.hide();
      }
    }
  });
</script>